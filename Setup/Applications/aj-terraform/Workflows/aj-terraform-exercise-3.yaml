harnessApiVersion: '1.0'
type: CANARY
concurrencyStrategy: INFRA
description: aj-terraform-exercise-
envName: aj-terraform-nonprod
failureStrategies:
- executionScope: WORKFLOW
  failureTypes:
  - APPLICATION_ERROR
  repairActionCode: ROLLBACK_WORKFLOW
  retryCount: 0
notificationRules:
- conditions:
  - FAILED
  executionScope: WORKFLOW
  notificationGroupAsExpression: false
  userGroupAsExpression: false
  userGroupIds:
  - FbPJlj-8R3eHWlRmJ2bjOw
preDeploymentSteps:
- type: TERRAFORM_PROVISION
  name: Terraform Plan
  properties:
    backendConfigs:
    - name: secret_key
      value: lfh1x2LJTF6MaZLo8roWhA
      valueType: ENCRYPTED_TEXT
    - name: access_key
      value: 2ssEiVvxR6S2LA4-iNJ7Zw
      valueType: ENCRYPTED_TEXT
    delegateTag: aj-delegate
    provisionerName: aj-excersie-3
    runPlanOnly: true
    tfVarFiles: null
    variables:
    - name: secret_key
      value: lfh1x2LJTF6MaZLo8roWhA
      valueType: ENCRYPTED_TEXT
    - name: access_key
      value: 2ssEiVvxR6S2LA4-iNJ7Zw
      valueType: ENCRYPTED_TEXT
    - name: s3_bucket_region
      value: us-east-1
      valueType: TEXT
    - name: s3_bucket_name
      value: ${workflow.variables.s3_bucket_name}
      valueType: TEXT
- type: APPROVAL
  name: Approval
  properties:
    approvalStateType: USER_GROUP
    timeoutMillis: 86400000
    userGroups:
    - FbPJlj-8R3eHWlRmJ2bjOw
- type: TERRAFORM_PROVISION
  name: Terraform Apply
  properties:
    inheritApprovedPlan: true
    provisionerName: aj-excersie-3
    runPlanOnly: false
    templateUuid: null
    templateVariables: null
    templateVersion: null
    tfVarFiles: null
    timeoutMillis: 300000
templatized: true
userVariables:
- type: TEXT
  fixed: false
  mandatory: true
  name: s3_bucket_name
